---
import Layout from "../layouts/Layout.astro";
---

<Layout
    title="è¤‡åˆ©æ•ˆæ‡‰è©¦ç®— | ä¸‹ç­å¾Œï¼Œè®“æ™‚é–“å¹«ä½ æ‰“å·¥"
    description="åˆ©ç”¨è¤‡åˆ©çš„åŠ›é‡ï¼Œè¨ˆç®—æ‚¨çš„é•·æœŸæŠ•è³‡æ”¶ç›Šã€‚è¦–è¦ºåŒ–æ‚¨çš„è²¡å¯Œå¢é•·ï¼Œäº†è§£ 72 æ³•å‰‡èˆ‡è¤‡åˆ©å¦‚ä½•å°‡å°é›ªçƒæ»¾æˆå·¨å¤§çš„è²¡å¯Œã€‚"
>
    <!-- Structured Data for SEO / AEO -->
    <script type="application/ld+json" is:inline slot="head">
        {
            "@context": "https://schema.org",
            "@graph": [
                {
                    "@type": "SoftwareApplication",
                    "name": "è¤‡åˆ©æ•ˆæ‡‰è©¦ç®—",
                    "applicationCategory": "FinanceApplication",
                    "operatingSystem": "Web",
                    "description": "è¦–è¦ºåŒ–è¤‡åˆ©æ•ˆæ‡‰èˆ‡æ‹¿éµå› å­ï¼Œäº†è§£æ™‚é–“å°è²¡å¯Œçš„å½±éŸ¿ï¼Œæ”¯æ´è€ƒæ…®é€šè†¨çš„å¯¦è³ªè³¼è²·åŠ›è¨ˆç®—ã€‚",
                    "offers": {
                        "@type": "Offer",
                        "price": "0",
                        "priceCurrency": "TWD"
                    }
                },
                {
                    "@type": "BreadcrumbList",
                    "itemListElement": [
                        {
                            "@type": "ListItem",
                            "position": 1,
                            "name": "é¦–é ",
                            "item": "https://assets-manager-beige.vercel.app/"
                        },
                        {
                            "@type": "ListItem",
                            "position": 2,
                            "name": "è¤‡åˆ©æ•ˆæ‡‰è©¦ç®—",
                            "item": "https://assets-manager-beige.vercel.app/compound-interest"
                        }
                    ]
                }
            ]
        }
    </script>
    <main
        class="container mx-auto px-4 py-8 md:py-12 max-w-7xl min-h-screen relative z-10"
    >
        <!-- Header -->
        <header class="text-center mb-12 animate-fade-in-down">
            <h1
                class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4 tracking-tight"
            >
                ä¸‹ç­å¾Œï¼Œè®“æ™‚é–“å¹«ä½ æ‰“å·¥
            </h1>
            <p class="text-lg text-slate-500 font-medium">
                è¦‹è­‰ã€Œè¤‡åˆ©ã€å¦‚ä½•å°‡å°é›ªçƒæ»¾æˆå·¨å¤§çš„è²¡å¯Œã€‚
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-start">
            <!-- Left Column: Controls -->
            <div class="lg:col-span-4 space-y-6">
                <div
                    class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-8"
                >
                    <h2
                        class="text-xl font-bold text-slate-900 flex items-center gap-2"
                    >
                        <span class="w-1.5 h-6 bg-blue-600 rounded-full"></span>
                        æŠ•è³‡åƒæ•¸è¨­å®š
                    </h2>

                    <!-- Initial Capital -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-bold text-slate-600"
                                >åˆå§‹æœ¬é‡‘</label
                            >
                            <span
                                id="val-initial-capital"
                                class="text-xl font-mono font-bold text-blue-600"
                                >$0</span
                            >
                        </div>
                        <input
                            type="range"
                            id="input-initial-capital"
                            min="0"
                            max="10000000"
                            step="10000"
                            value="100000"
                            class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div
                            class="flex justify-between text-[10px] text-slate-400 font-medium px-1"
                        >
                            <span>$0</span>
                            <span>$1,000è¬</span>
                        </div>
                    </div>

                    <!-- Monthly Investment -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-bold text-slate-600"
                                >æ¯æœˆæŠ•å…¥</label
                            >
                            <span
                                id="val-monthly-investment"
                                class="text-xl font-mono font-bold text-blue-600"
                                >$0</span
                            >
                        </div>
                        <input
                            type="range"
                            id="input-monthly-investment"
                            min="0"
                            max="200000"
                            step="1000"
                            value="10000"
                            class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div
                            class="flex justify-between text-[10px] text-slate-400 font-medium px-1"
                        >
                            <span>$0</span>
                            <span>$20è¬</span>
                        </div>
                    </div>

                    <!-- Annual Return Rate -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-bold text-slate-600"
                                >é è¨ˆå¹´åŒ–å ±é…¬ç‡</label
                            >
                            <span
                                id="val-return-rate"
                                class="text-xl font-mono font-bold text-blue-600"
                                >7%</span
                            >
                        </div>
                        <input
                            type="range"
                            id="input-return-rate"
                            min="1"
                            max="20"
                            step="0.5"
                            value="7"
                            class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div class="flex flex-wrap gap-2 pt-2">
                            <button
                                class="preset-rate text-[10px] px-3 py-1 rounded-full bg-slate-100 text-slate-600 hover:bg-blue-600 hover:text-white transition-all font-bold"
                                data-rate="4">ä¿å®ˆå‹ 4%</button
                            >
                            <button
                                class="preset-rate text-[10px] px-3 py-1 rounded-full bg-slate-100 text-slate-600 hover:bg-blue-600 hover:text-white transition-all font-bold"
                                data-rate="7">å°è‚¡å¤§ç›¤ 7%</button
                            >
                            <button
                                class="preset-rate text-[10px] px-3 py-1 rounded-full bg-slate-100 text-slate-600 hover:bg-blue-600 hover:text-white transition-all font-bold"
                                data-rate="10">ç¾è‚¡å¤§ç›¤ 10%</button
                            >
                        </div>
                    </div>

                    <!-- Investment Years -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <label class="text-sm font-bold text-slate-600"
                                >æŠ•è³‡å¹´é™</label
                            >
                            <span
                                id="val-years"
                                class="text-xl font-mono font-bold text-blue-600"
                                >30å¹´</span
                            >
                        </div>
                        <input
                            type="range"
                            id="input-years"
                            min="1"
                            max="50"
                            step="1"
                            value="30"
                            class="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div
                            class="flex justify-between text-[10px] text-slate-400 font-medium px-1"
                        >
                            <span>1å¹´</span>
                            <span>50å¹´</span>
                        </div>
                    </div>

                    <!-- Inflation Toggle -->
                    <div
                        class="pt-6 border-t border-slate-100 flex items-center justify-between"
                    >
                        <div>
                            <label
                                class="text-sm font-bold text-slate-900 block"
                                >è€ƒæ…®é€šè†¨èª¿ç¯€ (2%)</label
                            >
                            <p class="text-[10px] text-slate-500">
                                è¨ˆç®—ã€Œå¯¦è³ªè³¼è²·åŠ›ã€
                            </p>
                        </div>
                        <button
                            id="toggle-inflation"
                            class="relative inline-flex h-6 w-11 items-center rounded-full bg-slate-200 transition-colors focus:outline-none"
                        >
                            <span
                                class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"
                                id="inflation-knob"></span>
                        </button>
                    </div>
                </div>

                <!-- Lifestyle Presets -->
                <div
                    class="bg-blue-600 rounded-[2.5rem] p-8 text-white space-y-6 shadow-xl shadow-blue-200"
                >
                    <h3 class="text-lg font-bold flex items-center gap-2">
                        <span>â˜•ï¸</span> æ‹¿éµå› å­è½‰æ›å™¨
                    </h3>
                    <div class="grid grid-cols-1 gap-3">
                        <button
                            class="lifestyle-btn flex items-center justify-between bg-white/10 hover:bg-white/20 p-4 rounded-2xl transition-all text-left group"
                            data-amount="150"
                            data-freq="daily"
                        >
                            <div>
                                <div class="font-bold">æ¯å¤©ä¸€æ¯ç²¾å“å’–å•¡</div>
                                <div class="text-[10px] opacity-70">
                                    $150 / å¤©
                                </div>
                            </div>
                            <span
                                class="opacity-0 group-hover:opacity-100 transition-opacity"
                                >â†’</span
                            >
                        </button>
                        <button
                            class="lifestyle-btn flex items-center justify-between bg-white/10 hover:bg-white/20 p-4 rounded-2xl transition-all text-left group"
                            data-amount="3000"
                            data-freq="monthly"
                        >
                            <div>
                                <div class="font-bold">æ¯æœˆä¸€æ¬¡å¥¢è¯å¤§é¤</div>
                                <div class="text-[10px] opacity-70">
                                    $3,000 / æœˆ
                                </div>
                            </div>
                            <span
                                class="opacity-0 group-hover:opacity-100 transition-opacity"
                                >â†’</span
                            >
                        </button>
                        <button
                            class="lifestyle-btn flex items-center justify-between bg-white/10 hover:bg-white/20 p-4 rounded-2xl transition-all text-left group"
                            data-amount="35000"
                            data-freq="yearly"
                        >
                            <div>
                                <div class="font-bold">æ¯å¹´æ›ä¸€æ”¯æ–° iPhone</div>
                                <div class="text-[10px] opacity-70">
                                    $35,000 / å¹´
                                </div>
                            </div>
                            <span
                                class="opacity-0 group-hover:opacity-100 transition-opacity"
                                >â†’</span
                            >
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Visualization -->
            <div class="lg:col-span-8 space-y-8">
                <!-- Data Overview Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div
                        class="bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl"
                    >
                        <div
                            class="absolute -right-10 -top-10 w-40 h-40 bg-blue-500 rounded-full opacity-10 blur-3xl"
                        >
                        </div>
                        <div class="relative z-10">
                            <p
                                class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2"
                            >
                                æœ€çµ‚è³‡ç”¢é ä¼°
                            </p>
                            <h3
                                id="hero-total"
                                class="text-4xl md:text-5xl font-mono font-bold text-blue-400"
                            >
                                $0
                            </h3>
                            <div
                                class="mt-4 flex items-center gap-2 text-sm text-slate-300"
                            >
                                <span
                                    class="px-2 py-0.5 bg-white/10 rounded-md text-[10px] font-bold"
                                    >è²¡å¯Œç¿»å€</span
                                >
                                <span id="hero-doubles">0</span> æ¬¡
                            </div>
                        </div>
                    </div>

                    <div
                        class="bg-white rounded-[2.5rem] p-8 border border-slate-200 shadow-sm flex items-center justify-between overflow-hidden relative group"
                    >
                        <div class="relative z-10">
                            <p
                                class="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2"
                            >
                                é›ªçƒè¦æ¨¡
                            </p>
                            <h3
                                id="snowball-label"
                                class="text-2xl font-bold text-slate-900"
                            >
                                èŒå£¯ä¸­...
                            </h3>
                            <p
                                class="text-xs text-slate-400 mt-2"
                                id="snowball-desc"
                            >
                                æ‚¨çš„è²¡å¯Œæ­£åœ¨åŠ é€Ÿæˆé•·
                            </p>
                        </div>
                        <div
                            class="relative w-24 h-24 flex items-center justify-center"
                        >
                            <div
                                id="snowball-sphere"
                                class="w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-600 rounded-full shadow-lg shadow-blue-200 transition-all duration-500"
                            >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Chart -->
                <div
                    class="bg-white rounded-[2.5rem] p-8 border border-slate-200 shadow-sm"
                >
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-slate-900">
                            è³‡ç”¢å¢é•·è¶¨å‹¢ (æœ¬é‡‘ vs æ”¶ç›Š)
                        </h3>
                        <div class="flex gap-4 text-[10px] font-bold">
                            <div class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-slate-300"
                                ></span> ç´¯ç©æœ¬é‡‘
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-blue-600"
                                ></span> è¤‡åˆ©æ”¶ç›Š
                            </div>
                        </div>
                    </div>
                    <div class="h-[400px] w-full">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <!-- Scenarios & Comparisons -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Cost of Waiting -->
                    <div
                        class="bg-amber-50 rounded-[2.5rem] p-8 border border-amber-100"
                    >
                        <h4
                            class="text-amber-900 font-bold mb-4 flex items-center gap-2"
                        >
                            â±ï¸ ã€Œæ™šé–‹å§‹ã€çš„ä»£åƒ¹
                        </h4>
                        <div class="space-y-3">
                            <p class="text-sm text-amber-800 leading-relaxed">
                                å¦‚æœæ‚¨æ™š <span class="font-bold">5</span> å¹´æ‰é–‹å§‹ï¼š
                            </p>
                            <div
                                class="p-4 bg-white/60 rounded-2xl border border-amber-200"
                            >
                                <div class="text-xs text-amber-700 mb-1">
                                    æ¯æœˆéœ€å¤šå­˜å…¥ï¼š
                                </div>
                                <div
                                    id="cost-of-waiting"
                                    class="text-2xl font-mono font-bold text-amber-600"
                                >
                                    $0
                                </div>
                            </div>
                            <p class="text-[10px] text-amber-600">
                                è¤‡åˆ©æœ€å¤§çš„å°æ‰‹ä¸æ˜¯è™§æï¼Œè€Œæ˜¯æ™‚é–“ã€‚
                            </p>
                        </div>
                    </div>

                    <!-- Bill Coverage -->
                    <div
                        class="bg-emerald-50 rounded-[2.5rem] p-8 border border-emerald-100"
                    >
                        <h4
                            class="text-emerald-900 font-bold mb-4 flex items-center gap-2"
                        >
                            ğŸ“ˆ å¸³å–®è¦†è“‹æ¨¡æ“¬
                        </h4>
                        <div class="space-y-4">
                            <p class="text-sm text-emerald-800">
                                é€€ä¼‘å¾Œæ¯æœˆé ˜å›ï¼ˆ4% æé ˜ç‡ï¼‰ï¼š
                            </p>
                            <div
                                id="bill-coverage-amount"
                                class="text-3xl font-mono font-bold text-emerald-600"
                            >
                                $0
                            </div>
                            <p
                                id="bill-coverage-text"
                                class="text-xs text-emerald-700 leading-relaxed"
                            >
                                --
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Educational Content Section for AEO -->
        <section
            class="mt-24 max-w-4xl mx-auto space-y-16 border-t border-slate-100 pt-16 pb-24"
        >
            <div class="space-y-8">
                <h2
                    class="text-3xl font-extrabold text-slate-900 tracking-tight text-center"
                >
                    æŒæ¡è¤‡åˆ©çš„ç¥å¥‡åŠ›é‡
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="space-y-3">
                        <div class="text-3xl">â„ï¸</div>
                        <h3 class="text-xl font-bold text-slate-900">
                            ä»€éº¼æ˜¯è¤‡åˆ©ï¼Ÿ
                        </h3>
                        <p class="text-slate-500 text-xs leading-relaxed">
                            è¤‡åˆ©æ˜¯å°‡è³ºå¾—çš„åˆ©æ¯å†æ»¾å…¥æœ¬é‡‘ï¼Œéš¨æ™‚é–“æ¨ç§»ï¼Œæ”¶ç›Šæœƒåƒæ»¾é›ªçƒä¸€æ¨£åŠ é€Ÿå¢é•·ã€‚æ„›å› æ–¯å¦æ›¾ç¨±ä¹‹ç‚ºã€Œä¸–ç•Œç¬¬å…«å¤§å¥‡è¹Ÿã€ã€‚
                        </p>
                    </div>
                    <div class="space-y-3">
                        <div class="text-3xl">ğŸ”¢</div>
                        <h3 class="text-xl font-bold text-slate-900">
                            72 æ³•å‰‡æ˜¯ä»€éº¼ï¼Ÿ
                        </h3>
                        <p class="text-slate-500 text-xs leading-relaxed">
                            é€™æ˜¯ä¸€å€‹å¿«é€Ÿä¼°ç®—è³‡ç”¢ç¿»å€æ™‚é–“çš„å…¬å¼ï¼š72
                            é™¤ä»¥å¹´å ±é…¬ç‡ã€‚ä¾‹å¦‚ 7% çš„å ±é…¬ç‡ï¼Œç´„æ¯ 10
                            å¹´èƒ½è®“æ‚¨çš„è³‡é‡‘ç¿»å€ä¸€æ¬¡ã€‚
                        </p>
                    </div>
                    <div class="space-y-3">
                        <div class="text-3xl">ğŸ’¸</div>
                        <h3 class="text-xl font-bold text-slate-900">
                            é€šè†¨çš„éš±å½¢å¨è„…
                        </h3>
                        <p class="text-slate-500 text-xs leading-relaxed">
                            é•·æœŸä¾†çœ‹ï¼Œé€šè†¨æœƒä¾µè•è³¼è²·åŠ›ã€‚2% é€šè†¨ä»£è¡¨ 35
                            å¹´å¾Œç‰©åƒ¹æœƒç¿»å€ã€‚æœ¬è¨ˆç®—æ©Ÿæä¾›ã€Œé€šè†¨èª¿ç¯€ã€åŠŸèƒ½ï¼Œå¹«åŠ©æ‚¨çœ‹åˆ°è³‡ç”¢çš„çœŸå¯¦è³¼è²·åŠ›ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <div class="bg-blue-600 rounded-[2.5rem] p-8 md:p-12 text-white">
                <h3 class="text-2xl font-extrabold mb-8 text-center text-white">
                    å¸¸è¦‹å•é¡Œ FAQ
                </h3>
                <div class="space-y-6">
                    <div
                        class="bg-white/10 rounded-2xl p-6 border border-white/10"
                    >
                        <h4 class="text-lg font-bold mb-2 text-white">
                            ã€Œæ‹¿éµå› å­ã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿ
                        </h4>
                        <p class="text-slate-200 text-sm">
                            æ‹¿éµå› å­æ˜¯æŒ‡ç”Ÿæ´»ä¸­çœ‹ä¼¼ä¸èµ·çœ¼çš„å¾®å°æ”¯å‡ºï¼ˆå¦‚æ¯å¤©ä¸€æ¯
                            150
                            å…ƒçš„å’–å•¡ï¼‰ã€‚å¦‚æœå°‡é€™ç­†éŒ¢çœä¸‹ä¾†é•·æœŸæŠ•å…¥å¸‚å ´ï¼Œé€éè¤‡åˆ©æ»¾å‹•ï¼Œæ•¸åå¹´å¾Œå¯èƒ½æœƒè®Šæˆä¸€ç­†æ¥µç‚ºå¯è§€çš„è²¡å¯Œã€‚
                        </p>
                    </div>
                    <div
                        class="bg-white/10 rounded-2xl p-6 border border-white/10"
                    >
                        <h4 class="text-lg font-bold mb-2 text-white">
                            å¦‚ä½•æé«˜è¤‡åˆ©çš„æ•ˆæœï¼Ÿ
                        </h4>
                        <p class="text-slate-200 text-sm">
                            è¤‡åˆ©æœ‰ä¸‰å¤§é—œéµè¦ç´ ï¼šæœ¬é‡‘ã€å¹´åŒ–å ±é…¬ç‡ã€ä»¥åŠã€Œæ™‚é–“ã€ã€‚å…¶ä¸­ã€Œæ™‚é–“ã€çš„å½±éŸ¿åŠ›æœ€å¤§ã€‚å³ä¾¿åˆæœŸæŠ•å…¥é‡‘é¡è¼ƒå°‘ï¼Œåªè¦èƒ½é•·æœŸå …æŒï¼Œå¾ŒæœŸçš„å¢é•·é€Ÿåº¦å°‡é è¶…æƒ³åƒã€‚
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>

<script>
    import Chart from "chart.js/auto";

    // State
    let config = {
        initialCapital: 100000,
        monthlyInvestment: 10000,
        returnRate: 7,
        years: 30,
        isInflationAdjusted: false,
    };

    let chart: any = null;

    // Elements
    const elements = {
        inputs: {
            initialCapital: document.getElementById(
                "input-initial-capital",
            ) as HTMLInputElement,
            monthlyInvestment: document.getElementById(
                "input-monthly-investment",
            ) as HTMLInputElement,
            returnRate: document.getElementById(
                "input-return-rate",
            ) as HTMLInputElement,
            years: document.getElementById("input-years") as HTMLInputElement,
        },
        labels: {
            initialCapital: document.getElementById("val-initial-capital"),
            monthlyInvestment: document.getElementById(
                "val-monthly-investment",
            ),
            returnRate: document.getElementById("val-return-rate"),
            years: document.getElementById("val-years"),
        },
        heroTotal: document.getElementById("hero-total"),
        heroDoubles: document.getElementById("hero-doubles"),
        snowballSphere: document.getElementById("snowball-sphere"),
        snowballLabel: document.getElementById("snowball-label"),
        snowballDesc: document.getElementById("snowball-desc"),
        toggleInflation: document.getElementById("toggle-inflation"),
        inflationKnob: document.getElementById("inflation-knob"),
        costOfWaiting: document.getElementById("cost-of-waiting"),
        billCoverageAmount: document.getElementById("bill-coverage-amount"),
        billCoverageText: document.getElementById("bill-coverage-text"),
    };

    const moneyFmt = new Intl.NumberFormat("zh-TW", {
        style: "currency",
        currency: "TWD",
        maximumFractionDigits: 0,
    });

    function init() {
        // Event Listeners for Sliders
        Object.keys(elements.inputs).forEach((key) => {
            const el = elements.inputs[key as keyof typeof elements.inputs];
            el.addEventListener("input", (e) => {
                const val = parseFloat((e.target as HTMLInputElement).value);
                (config as any)[key] = val;
                updateUI();
            });
        });

        // Preset Rate Buttons
        document.querySelectorAll(".preset-rate").forEach((btn) => {
            btn.addEventListener("click", (e) => {
                const rate = parseFloat(
                    (e.target as HTMLElement).dataset.rate || "7",
                );
                config.returnRate = rate;
                elements.inputs.returnRate.value = rate.toString();
                updateUI();
            });
        });

        // Lifestyle Presets
        document.querySelectorAll(".lifestyle-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
                const btnEl = e.currentTarget as HTMLElement;
                const amount = parseFloat(btnEl.dataset.amount || "0");
                const freq = btnEl.dataset.freq;

                let monthlyAmount = amount;
                if (freq === "daily") monthlyAmount = amount * 30;
                if (freq === "yearly") monthlyAmount = amount / 12;

                config.monthlyInvestment = monthlyAmount;
                elements.inputs.monthlyInvestment.value =
                    monthlyAmount.toString();
                updateUI();
            });
        });

        // Inflation Toggle
        elements.toggleInflation?.addEventListener("click", () => {
            config.isInflationAdjusted = !config.isInflationAdjusted;
            elements.toggleInflation?.classList.toggle(
                "bg-blue-600",
                config.isInflationAdjusted,
            );
            elements.toggleInflation?.classList.toggle(
                "bg-slate-200",
                !config.isInflationAdjusted,
            );
            elements.inflationKnob?.classList.toggle(
                "translate-x-6",
                config.isInflationAdjusted,
            );
            elements.inflationKnob?.classList.toggle(
                "translate-x-1",
                !config.isInflationAdjusted,
            );
            updateUI();
        });

        initChart();
        updateUI();
    }

    function initChart() {
        const ctx = document.getElementById("growthChart") as HTMLCanvasElement;
        if (!ctx) return;

        chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [
                    {
                        label: "ç´¯ç©æœ¬é‡‘",
                        data: [],
                        borderColor: "#cbd5e1",
                        backgroundColor: "rgba(203, 213, 225, 0.4)",
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 0,
                        tension: 0.1,
                    },
                    {
                        label: "è¤‡åˆ©æ”¶ç›Š",
                        data: [],
                        borderColor: "#2563eb",
                        backgroundColor: "rgba(37, 99, 235, 0.7)",
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 0,
                        tension: 0.1,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: "index", intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: "rgba(255, 255, 255, 0.95)",
                        titleColor: "#1e293b",
                        bodyColor: "#475569",
                        borderColor: "#e2e8f0",
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || "";
                                if (label) label += ": ";
                                if (context.parsed.y !== null)
                                    label += moneyFmt.format(context.parsed.y);
                                return label;
                            },
                        },
                    },
                },
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        ticks: {
                            callback: (val) => {
                                if (typeof val === "number") {
                                    if (val >= 1000000)
                                        return (
                                            "$" +
                                            (val / 1000000).toFixed(1) +
                                            "M"
                                        );
                                    if (val >= 10000)
                                        return (
                                            "$" +
                                            (val / 10000).toFixed(0) +
                                            "è¬"
                                        );
                                    return "$" + val;
                                }
                                return val;
                            },
                        },
                    },
                },
            },
        });
    }

    function calculateGrowth(
        P: number,
        PMT: number,
        rPct: number,
        n: number,
        inflationPct: number = 0,
    ) {
        const dataPrincipal = [];
        const dataInterest = [];
        const labels = [];

        // Adjust rate for inflation if needed
        // Fisher equation: (1 + nominal) = (1 + real) * (1 + inflation)
        // real = (1 + nominal) / (1 + inflation) - 1
        const r = rPct / 100;
        const i = inflationPct / 100;
        const effectiveRate = config.isInflationAdjusted
            ? (1 + r) / (1 + i) - 1
            : r;
        const monthlyRate = effectiveRate / 12;

        let totalPrincipal = P;
        let totalValue = P;

        for (let year = 0; year <= n; year++) {
            labels.push(`ç¬¬ ${year} å¹´`);
            dataPrincipal.push(totalPrincipal);
            dataInterest.push(Math.max(0, totalValue - totalPrincipal));

            if (year < n) {
                for (let m = 0; m < 12; m++) {
                    totalValue = (totalValue + PMT) * (1 + monthlyRate);
                    totalPrincipal += PMT;
                }
            }
        }

        return { labels, dataPrincipal, dataInterest, finalValue: totalValue };
    }

    function updateUI() {
        // Labels
        if (elements.labels.initialCapital)
            elements.labels.initialCapital.textContent = moneyFmt.format(
                config.initialCapital,
            );
        if (elements.labels.monthlyInvestment)
            elements.labels.monthlyInvestment.textContent = moneyFmt.format(
                config.monthlyInvestment,
            );
        if (elements.labels.returnRate)
            elements.labels.returnRate.textContent = config.returnRate + "%";
        if (elements.labels.years)
            elements.labels.years.textContent = config.years + "å¹´";

        // Calculation
        const result = calculateGrowth(
            config.initialCapital,
            config.monthlyInvestment,
            config.returnRate,
            config.years,
            2,
        );

        // Chart Update
        if (chart) {
            chart.data.labels = result.labels;
            chart.data.datasets[0].data = result.dataPrincipal;
            chart.data.datasets[1].data = result.dataInterest;
            chart.update("none");
        }

        // Hero Stats with Count-up (Simulation)
        if (elements.heroTotal) {
            animateCountUp(elements.heroTotal, result.finalValue);
        }

        // Rule of 72 Doubles
        if (elements.heroDoubles) {
            if (config.returnRate > 0) {
                const totalReturnRatio =
                    result.finalValue /
                    (config.initialCapital +
                        config.monthlyInvestment * config.years * 12);
                const doubles = Math.log2(totalReturnRatio);
                elements.heroDoubles.textContent =
                    doubles > 0 ? doubles.toFixed(1) : "0";
            }
        }

        // Snowball Animation
        if (elements.snowballSphere) {
            const scale = Math.min(2.5, 0.5 + result.finalValue / 10000000);
            elements.snowballSphere.style.transform = `scale(${scale})`;
            elements.snowballSphere.style.filter = `brightness(${0.8 + scale * 0.2}) blur(${Math.max(0, (scale - 1) * 2)}px)`;
        }

        // Snowball Labels
        if (result.finalValue > 10000000) {
            if (elements.snowballLabel)
                elements.snowballLabel.textContent = "è²¡å¯Œè‡ªç”±ä¹‹å·”";
            if (elements.snowballDesc)
                elements.snowballDesc.textContent = "æ‚¨çš„é›ªçƒå·²ç¶“å‹¢ä¸å¯æ“‹ï¼";
        } else if (result.finalValue > 5000000) {
            if (elements.snowballLabel)
                elements.snowballLabel.textContent = "è³‡ç”¢åŠ é€Ÿç‹‚é£†";
            if (elements.snowballDesc)
                elements.snowballDesc.textContent = "è¤‡åˆ©æ•ˆæ‡‰æ­£é¡¯ç¾å·¨å¤§å¨åŠ›ã€‚";
        } else {
            if (elements.snowballLabel)
                elements.snowballLabel.textContent = "ç©©å®šç´®åŸºä¸­";
            if (elements.snowballDesc)
                elements.snowballDesc.textContent =
                    "æŒçºŒæŠ•å…¥ï¼Œç­‰å¾…æ™‚é–“é–‹èŠ±çµæœã€‚";
        }

        // Cost of Waiting (5 years later)
        const waitResult = calculateGrowth(
            config.initialCapital,
            config.monthlyInvestment,
            config.returnRate,
            config.years - 5,
        );
        // How much more monthly PMT needed in (years-5) to reach same finalValue?
        // PMT_needed = (FinalValue - P*(1+r)^n) / (((1+r)^n - 1) / r)
        const target = result.finalValue;
        const P = config.initialCapital;
        const n = (config.years - 5) * 12;
        const r = config.returnRate / 100 / 12;
        const futureValueOfP = P * Math.pow(1 + r, n);
        const pmtNeeded =
            (target - futureValueOfP) / ((Math.pow(1 + r, n) - 1) / r);
        const diff = pmtNeeded - config.monthlyInvestment;

        if (elements.costOfWaiting) {
            elements.costOfWaiting.textContent =
                diff > 0 ? moneyFmt.format(diff) : "$0";
        }

        // Bill Coverage (4% Safe Withdrawal Rate per month)
        const monthlyWithdrawal = (result.finalValue * 0.04) / 12;
        if (elements.billCoverageAmount)
            elements.billCoverageAmount.textContent =
                moneyFmt.format(monthlyWithdrawal);

        let coverageText = "è¶³ä»¥æ‡‰ä»˜æ—¥å¸¸åŸºæœ¬é–‹éŠ·ã€‚";
        if (monthlyWithdrawal > 100000)
            coverageText = "ç›¸ç•¶æ–¼æ¯æœˆå¤šé ˜ä¸€ä»½é«˜éšä¸»ç®¡è–ªæ°´ã€‚";
        else if (monthlyWithdrawal > 50000)
            coverageText = "è¶³ä»¥æ”¯ä»˜å°åŒ—å¸‚ä¸­å¿ƒçš„å„ªè³ªæˆ¿ç§Ÿã€‚";
        else if (monthlyWithdrawal > 20000)
            coverageText = "è¶³ä»¥è¦†è“‹å¤§éƒ¨ä»½çš„ç”Ÿæ´»é›œæ”¯èˆ‡å¸³å–®ã€‚";

        if (elements.billCoverageText)
            elements.billCoverageText.textContent = coverageText;
    }

    function animateCountUp(el: HTMLElement, target: number) {
        const start = 0;
        const duration = 1000;
        let startTime: number | null = null;

        function step(timestamp: number) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            const current = Math.floor(progress * target);
            el.textContent = moneyFmt.format(current);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                el.textContent = moneyFmt.format(target);
            }
        }
        window.requestAnimationFrame(step);
    }

    init();
</script>

<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-fade-in-down {
        animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: #2563eb;
        border-radius: 50%;
        cursor: pointer;
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }

    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: #2563eb;
        border-radius: 50%;
        cursor: pointer;
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
</style>
